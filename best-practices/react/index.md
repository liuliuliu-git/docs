---
outline: deep
---

# React 最佳实践

React 和 Next.js 性能优化指南，涵盖 8 个类别、40+ 条规则。

## 优先级

规则按影响程度排序：

| 优先级 | 类别 | 影响程度 |
|--------|------|----------|
| 1 | 消除瀑布流 | 关键 |
| 2 | 优化打包体积 | 关键 |
| 3 | 服务端性能 | 高 |
| 4 | 客户端数据获取 | 中高 |
| 5 | 重渲染优化 | 中 |
| 6 | 渲染性能 | 中 |
| 7 | JavaScript 性能 | 低中 |
| 8 | 高级模式 | 低 |

## 关键模式（优先应用）

### 消除瀑布流

- **延迟 await**：将 `await` 延迟到真正需要的时候（移入条件分支）
- **Promise.all**：对独立的异步操作使用 `Promise.all()` 并行执行
- **早开始、晚等待**：尽早启动 Promise，延迟 await
- **使用 Suspense 边界**：流式传输内容

### 减少打包体积

- **避免 barrel 文件导入**：直接从源文件导入，而非通过索引文件
- **使用 `next/dynamic`**：动态加载重型组件
- **延迟加载非关键第三方库**
- **根据用户意图预加载**

## 服务端模式（高影响）

- 使用 `React.cache()` 进行单请求去重
- 使用 LRU 缓存实现跨请求缓存
- 最小化 RSC 边界的序列化
- 通过组件组合实现数据获取并行化

## 客户端模式（中影响）

- 使用 SWR 进行自动请求去重
- 将状态读取延迟到使用点
- 对昂贵值使用惰性状态初始化
- 使用派生状态订阅
- 对非紧急更新应用 `startTransition`

## 渲染模式

- 使用 SVG 包装器而非直接动画化 SVG 元素
- 对长列表使用 `content-visibility: auto`
- 使用内联脚本防止水合不匹配
- 使用显式条件渲染（`? :` 而非 `&&`）

## JavaScript 模式

- 通过类批量处理 DOM CSS 更改
- 为重复查找构建索引映射
- 缓存重复的函数调用
- 使用 `toSorted()` 替代 `sort()` 保持不可变性
- 数组比较时先检查长度

## 相关资源

- [React 学习指南](/guides/react/)
- [React API 参考](/api/react/)
